# SPDX-FileCopyrightText: 2025 Thomas Mathys
# SPDX-License-Identifier: MIT

name: Linux Builds

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    name: Linux Builds (${{matrix.cxx_compiler}}, ${{matrix.build_type}})
    runs-on: ubuntu-latest

    strategy:
      fail-fast: true
      matrix:
        cxx_compiler: [clang++, g++-14]
        build_type: [Release, Debug]

    steps:

    - name: Set reusable strings
      id: strings
      shell: bash
      run: |
        echo "build-output-dir=${{github.workspace}}/build" >> "$GITHUB_OUTPUT"

    - name: Checkout
      uses: actions/checkout@v4

    # TODO: do we want to install Catch2?
    - name: Configure
      run: >
        cmake
        -B ${{steps.strings.outputs.build-output-dir}}
        -S ${{github.workspace}}
        --preset dev-linux-ninja
        -DCMAKE_CXX_COMPILER=${{matrix.cxx_compiler}}
        -DCMAKE_BUILD_TYPE=${{matrix.build_type}}

    - name: Build
      run: cmake --build ${{steps.strings.outputs.build-output-dir}} --config ${{matrix.build_type}}

# TODO: port stuff below


#     - name: Configure CMake
#       # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
#       # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
#       run: >
#         --preset ${{ matrix.cmake_preset }}
#         ${{ matrix.cmake_arch }}
#         -DCMAKE_CXX_COMPILER=${{ matrix.cpp_compiler }}
#         -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}
#     - name: Build
#       # Build your program with the given configuration. Note that --config is needed because the default Windows generator is a multi-config generator (Visual Studio generator).
#     - name: Test
#       working-directory: ${{ steps.strings.outputs.build-output-dir }}
#       # Execute tests defined by the CMake configuration. Note that --build-config is needed because the default Windows generator is a multi-config generator (Visual Studio generator).
#       # See https://cmake.org/cmake/help/latest/manual/ctest.1.html for more detail
#       run: ctest --build-config ${{ matrix.build_type }}
